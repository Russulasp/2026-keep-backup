## 薄い縦切り一本分の見通し

### 1. この一本で“通す”こと（最小の成功パス）
- Windowsで `backup_keep.bat` をダブルクリック
- WSL(Ubuntu) 上で Docker コンテナを起動
- コンテナ内の Playwright が **ログイン済みブラウザプロファイル**を使って Google Keep を開く
- 画面に見えている範囲だけでいいので、ノート本文を少数取得して `keep.json` に保存
- 1本のログファイルに「成功/失敗・取得件数・出力先」を残して終了

> 目的：最初から最後まで“動く”を確認するだけ。網羅性（全件取得）やアーカイブ/ゴミ箱は捨てる。

—

### 2. 意図的に捨てるもの（今回の薄さの核心）
- 全件取得（スクロールで無限に読み込む処理はやらない）
- アーカイブ／ゴミ箱の取得
- チェックリスト構造、ラベル等の付随要素
- 自動ログイン（認証フローはコードで書かない）
- 保持ポリシー（古いバックアップ削除）
- HTML生成やGoogle Docs化

—

### 3. 入口を極限まで単純化（Windows→WSL）
- バッチは「WSLで所定コマンドを叩く」だけにする  
  - 例：`wsl -d Ubuntu -e bash -lc "cd ~/keep-backup && docker compose run —rm app"`
- パスや設定値はWSL側（`.env` や設定ファイル）に寄せ、バッチに持たせない

—

### 4. 実行環境を固定（WSL→Docker）
- DockerにPlaywright実行環境を閉じ込める
- WSL側のプロジェクト直下に、最低限これだけ置く
  - `backups/`（出力）
  - `logs/`（ログ）
- コンテナにはこの2つをマウントして、**常に同じ場所に出す**ようにする

—

### 5. 認証は“運用”で解く（最もバグが少ない）
- 事前に、指定したブラウザプロファイルで Google Keep にログインしておく
- Playwrightはそのプロファイルを指定して起動し、ログイン処理は書かない
- 実行時にログインが切れていたら「失敗」としてログに残して終わる（リトライもしない）

—

### 6. 取得ロジックは“画面に見える分だけ”でOK
- Keepを開く
- 画面に表示されているノートカードを列挙
- 各カードを開いて本文テキストを抜く（取れないものはスキップ）
- 取得件数が0なら失敗扱いにしてログに残す

> 「スクロール」「重複除去」「ページング」は全部捨てる。まず“抜ける”を確認する。

—

### 7. 出力は JSON 1ファイルだけ（壊れにくい最小構造）
- 出力先：`backups/YYYY-MM-DD/keep.json`
- 形式は最小限で固定
  - `scraped_at`（実行日時）
  - `notes`（配列）
    - 各要素は `body`（本文テキスト）だけでもよい
- 失敗情報はログに寄せ、JSONに無理に詰めない（薄い縦切りなので）

—

### 8. ログは“運用の最低限”だけ
- 出力先：`logs/run_YYYY-MM-DD_HHMMSS.log`
- 書く内容（最低限）
  - 開始時刻 / 終了時刻
  - 成功 or 失敗（終了コード）
  - 取得件数
  - 出力ディレクトリ
  - 失敗時の例外メッセージ（あれば）

—

### 9. この一本の完了条件（Done）
- バッチ一発で最後まで走る
- `backups/YYYY-MM-DD/keep.json` が生成され、中に本文が複数入っている
- `logs/run_*.log` が生成され、成功・件数・出力先が分かる

> ここまで到達したら勝ち。次のステップで「全件取得」「アーカイブ/ゴミ箱」「保持」「自動実行」に広げる前提の土台ができる。