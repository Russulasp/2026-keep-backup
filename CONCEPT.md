# Google Keep バックアップ（手動実行MVP）プロジェクト趣旨

## 1. 目的（Why）
Google Keep のノートを、誤操作や障害により「まとめて消える」事態に備えて、手元に退避・保管するための仕組みを作る。  
当面のゴールは **確実に保管できること**であり、復元の自動化は後続フェーズで扱う。

## 2. 想定する復元レベル（現段階の定義）
- **現段階（Phase 1）**：バックアップファイルを開けば内容を確認でき、必要なら手作業でコピペ等により復元できる状態を作る
- **将来（Phase 2 以降）**：Keep への自動/半自動の復元は検討対象（現段階では要件に含めない）

## 3. バックアップ対象（What） — Must / Should / Could
### Must（MVPで必ず取る）
- ノート本文（テキスト）
- ノート識別に必要な最小メタ情報（例：タイトル相当、作成日時/更新日時のどちらか、ノートID相当）
- 取得時点で Keep 上に存在する全ノート（フルバックアップの定義に含める）

### Should（できるだけ取る：MVPに含むが、欠けても致命傷ではない）
- アーカイブのノート
- ゴミ箱（削除済み）ノート

### Could（後回しでもよい：将来拡張）
- チェックリストの構造、ラベル、色、リマインダー、共同編集などの付随要素
- 添付（画像・音声・手書き等）

> 「本文だけで十分」という優先順位を守りつつ、取りこぼしリスクを下げるためにアーカイブ/ゴミ箱も対象に含める。

## 4. 取得方式（How）— Playwright採用理由と認証ポリシー
### Playwright を使う理由（短く固定）
- 取得対象が Keep の画面表示と一致し、API仕様変更やエクスポート形式差分に引きずられにくい
- 自動化の入口/出口を単純化でき、MVPの「確実に取れる」に寄せやすい

### 認証（ログイン）ポリシー：**バグ/難易度が少ない方式**
- **毎回、ユーザーが手動でログインした状態のブラウザを使う**（自動ログイン実装はしない）
- Playwright は「既存のブラウザプロファイル（ユーザーデータディレクトリ）」を利用し、ログイン済み状態を前提に実行する  
  - 例：最初に一度 Chrome/Edge で Keep にログインしておき、そのプロファイルを指定して起動する
- 2FA 等が絡んでも、手動ログイン運用なら実装側の複雑性を増やさずに回せる

> ねらい：認証フロー・トークン管理・2FA処理をコードで抱えず、「運用で解決」して堅牢にする。

## 5. 出力形式（Format）— 初期の第一候補を明示
現段階は「素直でバグが少ない」を最優先し、以下を採用する。

- **JSON（構造化データ）＋任意でHTML（閲覧用）**
  - JSON：ノート本文・メタ情報・状態（通常/アーカイブ/ゴミ箱）を保存
  - HTML：人がすぐ読める形の簡易ビュー（将来必要なら追加）

> まずは JSON を正とし、将来の Google Docs 化などの変換先を増やしやすくする。

## 6. フルバックアップの定義
- 1回の実行で **対象範囲（Must/Should）に含まれるノートをすべて取得して保存する**
- 差分取得は行わない（将来拡張）

## 7. 保存先・ディレクトリ方針
- 実行は WSL(Ubuntu) 上で行い、保存も **WSL側のプロジェクトディレクトリ配下**に集約する
- 推奨イメージ：
  - `project_root/`
    - `backups/YYYY-MM-DD/`（実行日ごとのスナップショット）
    - `logs/`
    - `scripts/`（実行用）
- Windows 側から閲覧したくなった場合は、後続フェーズで `/mnt/c/...` へのコピーや同期を検討する（現段階は必須にしない）

## 8. 保持（古いバックアップ削除）ポリシー（暫定）
- まずは運用を壊さないために **直近8世代を保持**（例）
- それより古いものは手動または簡易スクリプトで削除（詳細ロジックは後で調整）

## 9. 成功条件（MVPの完了条件）
- Windows のバッチダブルクリックで実行が開始できる
- 実行1回で、対象ノートがバックアップディレクトリに保存される
- ログに以下が残る：
  - 実行日時、取得件数、出力先、成功/失敗（終了コード）
- 失敗時でも、原因特定に必要な情報がログに残る

## 10. 失敗時の挙動（最低限）
- 終了コードを返す（成功=0、失敗=非0）
- 例外発生時はログにスタック/メッセージを残す
- 可能なら失敗時に **スクリーンショット**等のデバッグ材料を保存（MVPに含めてもよい）

## 11. 実行導線（Windows → WSL → Docker）
- Windows：`backup_keep.bat` をダブルクリック
- WSL：Docker コンテナを起動して Playwright を実行
- Docker：依存をコンテナに閉じ込め、実行環境差分を減らす（再現性を優先）

## 12. フェーズ分け（今やること / 後でやること）
### Phase 1（現段階：ローカル保管MVP）
- Playwright で Keep のノートを取得
- JSON（＋必要ならHTML）で日付フォルダに保存
- ログ出力・基本の保持ポリシー

### Phase 2（将来：運用自動化・外部保管）
- 定期実行（cron/タスクスケジューラ等）
- Google Docs への保存（**日付ごとに新規のDoc 1ファイル**を生成）
- 形式変換の拡充、復元支援の強化

## 13. セキュリティ/プライバシー（現段階の扱い）
- 暗号化は現時点では必須要件にしない
- ただしバックアップは個人用途のため、保存場所はアクセス権が管理できる場所に限定し、共有フォルダや意図しない同期先は避ける（必要なら後で運用を追加）